Version 4
SHEET 1 1960 1524
WIRE 704 80 320 80
WIRE 944 80 704 80
WIRE 1152 80 944 80
WIRE 320 112 320 80
WIRE 320 224 320 192
WIRE 704 224 704 80
WIRE 1152 224 1152 80
WIRE -288 288 -416 288
WIRE 480 304 432 304
WIRE 608 304 560 304
WIRE 656 304 608 304
WIRE 992 304 912 304
WIRE 1104 304 1072 304
WIRE -416 320 -416 288
WIRE 912 320 912 304
WIRE 1152 400 1152 320
WIRE 1152 400 912 400
WIRE -416 432 -416 400
WIRE 704 448 704 320
WIRE 1232 448 704 448
WIRE 1344 448 1232 448
WIRE 1472 448 1424 448
WIRE 1664 448 1552 448
WIRE 1696 448 1664 448
WIRE -320 480 -736 480
WIRE -288 480 -288 288
WIRE 336 480 192 480
WIRE 432 480 432 304
WIRE 432 480 336 480
WIRE 1696 480 1696 448
WIRE -96 496 -256 496
WIRE 16 496 -96 496
WIRE -368 512 -416 512
WIRE -320 512 -368 512
WIRE 704 512 704 448
WIRE 704 512 192 512
WIRE 16 528 -32 528
WIRE 336 544 192 544
WIRE 368 544 336 544
WIRE -416 576 -416 512
WIRE -32 576 -32 528
WIRE 16 576 -32 576
WIRE 272 576 192 576
WIRE -288 592 -288 512
WIRE 1152 608 1152 400
WIRE 1232 608 1152 608
WIRE 1696 608 1696 560
WIRE 1696 608 1232 608
WIRE 704 640 704 512
WIRE 1152 640 1152 608
WIRE -32 656 -32 576
WIRE -416 704 -416 656
WIRE 368 720 368 544
WIRE 432 720 368 720
WIRE 560 720 512 720
WIRE 656 720 560 720
WIRE 992 720 912 720
WIRE 1104 720 1072 720
WIRE 912 816 912 800
WIRE 1152 816 1152 736
WIRE 1152 816 912 816
WIRE 272 864 272 576
WIRE 704 864 704 736
WIRE 704 864 272 864
WIRE 1152 864 1152 816
WIRE 1152 864 704 864
WIRE 704 928 704 864
WIRE 608 1024 528 1024
WIRE 752 1024 672 1024
WIRE 896 1024 832 1024
WIRE 736 1104 688 1104
WIRE 768 1104 736 1104
WIRE 688 1136 688 1104
WIRE 896 1152 896 1024
WIRE 896 1152 720 1152
WIRE 944 1152 896 1152
WIRE 1120 1152 1024 1152
WIRE 1232 1152 1120 1152
WIRE -736 1168 -736 480
WIRE 336 1168 -736 1168
WIRE 528 1168 528 1024
WIRE 528 1168 336 1168
WIRE 656 1168 528 1168
WIRE 800 1184 720 1184
WIRE 832 1184 800 1184
WIRE 1232 1184 1232 1152
WIRE 688 1248 688 1200
WIRE 736 1248 688 1248
WIRE 768 1248 736 1248
WIRE 304 1296 256 1296
WIRE 336 1296 304 1296
WIRE 464 1296 416 1296
WIRE 496 1296 464 1296
WIRE 832 1296 832 1184
WIRE 1232 1328 1232 1264
WIRE 256 1344 256 1296
WIRE 416 1344 416 1296
WIRE 832 1424 832 1376
WIRE 256 1488 256 1424
WIRE 416 1488 416 1424
FLAG -416 704 0
FLAG -96 496 pwm
FLAG 704 928 0
FLAG -32 656 0
FLAG -288 592 0
FLAG -416 432 0
FLAG -368 512 tri
FLAG 608 304 g1
FLAG 560 720 g2
FLAG 1232 448 A
FLAG 1232 608 B
FLAG 1664 448 grid
FLAG 320 224 0
FLAG 1232 1328 0
FLAG 832 1424 0
FLAG 336 1168 reg
FLAG 336 480 dra
FLAG 336 544 drb
FLAG 944 80 dc
FLAG 800 1184 ref
FLAG 1120 1152 sens
FLAG 256 1488 0
FLAG 416 1488 0
FLAG 304 1296 +Vcc
FLAG 464 1296 -Vcc
FLAG 736 1104 +Vcc
FLAG 736 1248 -Vcc
SYMBOL res 576 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 10
SYMBOL res 528 704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 10
SYMBOL ind 1328 464 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 10m
SYMBOL MyComparator -288 496 R0
WINDOW 38 14 22 Left 2
SYMATTR InstName U2
SYMBOL voltage -416 560 R0
WINDOW 3 -195 188 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE({-vtri} {vtri} 0 {1/2/fs} {1/2/fs} {0} {1/fs})
SYMATTR InstName Vtri1
SYMBOL voltage -416 304 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 15
SYMBOL MyDriverHB 128 528 R0
WINDOW 0 -98 -76 Bottom 2
WINDOW 38 22 -75 Bottom 2
WINDOW 123 -51 103 Bottom 2
WINDOW 3 -51 131 Bottom 2
SYMATTR InstName U3
SYMATTR Value2 Tau=100n
SYMBOL Misc\\Epoly 912 704 R0
WINDOW 0 35 42 Left 2
WINDOW 3 -53 127 Left 2
SYMATTR InstName E1
SYMATTR Value value={V(dra,A)}
SYMBOL Misc\\Epoly 912 304 R0
WINDOW 0 24 24 Left 2
WINDOW 3 -39 115 Left 2
SYMATTR InstName E2
SYMATTR Value value={V(drb)}
SYMBOL voltage 1696 464 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vg
SYMATTR Value SINE(0 325.27 50 0)
SYMBOL voltage 320 96 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 49 52 Left 2
SYMATTR Value 400
SYMATTR InstName V3
SYMBOL res 1088 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10
SYMBOL res 1088 704 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 10
SYMBOL nmos 656 224 R0
SYMATTR InstName M1
SYMATTR Value SPA11N60C3
SYMBOL nmos 656 640 R0
SYMATTR InstName M2
SYMATTR Value SPA11N60C3
SYMBOL nmos 1104 640 R0
SYMATTR InstName M3
SYMATTR Value SPA11N60C3
SYMBOL nmos 1104 224 R0
SYMATTR InstName M4
SYMATTR Value SPA11N60C3
SYMBOL cap 672 1008 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C2
SYMATTR Value 1µ
SYMBOL res 848 1008 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL res 1040 1136 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 1k
SYMBOL Misc\\Epoly 1232 1168 R0
WINDOW 0 66 31 Left 2
WINDOW 3 48 63 Left 2
SYMATTR InstName E3
SYMATTR Value value = {i(Vg)}
SYMBOL voltage 832 1280 R0
WINDOW 0 50 53 Left 2
WINDOW 3 39 85 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value SINE(0 {1*sqrt(2)} 50 0)
SYMBOL res 1568 432 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 0.1
SYMBOL OpAmps\\UniversalOpamp2 688 1168 M0
WINDOW 123 54 34 Left 2
SYMATTR Value2 Avol=1e5 GBW=10Meg Slew=10Meg
SYMATTR InstName U1
SYMBOL voltage 256 1328 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value 4.5
SYMBOL voltage 416 1440 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 4.5
TEXT -24 144 Left 2 !.tran 0 60m 40m 0.1u uic\n.options reltol=0.01
TEXT -608 144 Left 2 !.param vtri 5         ; triangular waveform\n.param fs 100k      ; switching frequency
TEXT 1248 1160 Left 2 ;Grid current sensor
TEXT 856 1296 Left 2 ;Grid current reference
TEXT 456 1376 Left 2 ;Compensator output limits
